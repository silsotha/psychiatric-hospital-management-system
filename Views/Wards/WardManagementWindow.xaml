<Window x:Class="PsychiatricHospitalWPF.Views.Wards.WardManagementWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        Title="Управление палатами" 
        Height="700" Width="1100"
        WindowStartupLocation="CenterScreen">

    <Window.Resources>
        <Style TargetType="Button">
            <Setter Property="Padding" Value="12,6"/>
            <Setter Property="Margin" Value="5,0"/>
            <Setter Property="Cursor" Value="Hand"/>
        </Style>
    </Window.Resources>

    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
            <RowDefinition Height="200"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>

        <!-- шапка -->
        <Border Grid.Row="0" Background="#2196F3" Padding="15">
            <TextBlock Text="Управление палатами" 
                      FontSize="18" 
                      FontWeight="Bold" 
                      Foreground="White"/>
        </Border>

        <!-- панель кнопок -->
        <Border Grid.Row="1" Background="#f5f5f5" Padding="10" BorderBrush="#ddd" BorderThickness="0,0,0,1">
            <Grid>
                <StackPanel Orientation="Horizontal">
                    <Button x:Name="btnRefresh" 
                           Content="🔄 Обновить" 
                           Click="BtnRefresh_Click"
                           Background="#FF9800"
                           Foreground="White"
                           Padding="12,6"
                           Margin="0,0,5,0"
                           Cursor="Hand"/>

                    <Button x:Name="btnDepartmentStats" 
                           Content="📊 Статистика по отделениям" 
                           Click="BtnDepartmentStats_Click"
                           Background="#9C27B0"
                           Foreground="White"
                           Padding="12,6"
                           Margin="0,0,5,0"
                           Cursor="Hand"/>
                </StackPanel>

                <TextBlock x:Name="lblTotalStats" 
                          Text="Всего палат: 0"
                          HorizontalAlignment="Right"
                          VerticalAlignment="Center"
                          FontSize="12"
                          Foreground="Gray"/>
            </Grid>
        </Border>

        <!-- список палат -->
        <DataGrid x:Name="dgWards" 
                 Grid.Row="2"
                 AutoGenerateColumns="False"
                 IsReadOnly="True"
                 SelectionMode="Single"
                 RowHeight="40"
                 AlternatingRowBackground="#f9f9f9"
                 GridLinesVisibility="Horizontal"
                 HeadersVisibility="Column"
                 CanUserResizeRows="False"
                 SelectionChanged="DgWards_SelectionChanged">

            <DataGrid.Columns>
                <!-- индикатор статуса -->
                <DataGridTemplateColumn Header="Статус" Width="80">
                    <DataGridTemplateColumn.CellTemplate>
                        <DataTemplate>
                            <Grid>
                                <!-- цветной кружок -->
                                <Ellipse Width="20" 
                                        Height="20" 
                                        Fill="{Binding StatusBrush, Mode=OneWay}"
                                        HorizontalAlignment="Center"
                                        VerticalAlignment="Center"
                                        ToolTip="{Binding StatusText, Mode=OneWay}"/>
                            </Grid>
                        </DataTemplate>
                    </DataGridTemplateColumn.CellTemplate>
                </DataGridTemplateColumn>

                <DataGridTextColumn Header="Номер палаты" 
                                   Binding="{Binding WardNumber}" 
                                   Width="120"/>

                <DataGridTextColumn Header="Отделение" 
                                   Binding="{Binding Department}" 
                                   Width="*"
                                   MinWidth="150"/>

                <DataGridTextColumn Header="Всего мест" 
                                   Binding="{Binding TotalBeds}" 
                                   Width="100"/>

                <DataGridTextColumn Header="Занято" 
                                   Binding="{Binding OccupiedBeds}" 
                                   Width="80"/>

                <DataGridTextColumn Header="Свободно" 
                                   Binding="{Binding AvailableBeds}" 
                                   Width="90"/>

                <!-- прогресс-бар с процентом -->
                <DataGridTemplateColumn Header="Загрузка" Width="200">
                    <DataGridTemplateColumn.CellTemplate>
                        <DataTemplate>
                            <Grid Margin="5,0">
                                <ProgressBar Value="{Binding OccupancyRate, Mode=OneWay}" 
                                           Minimum="0" 
                                           Maximum="100"
                                           Height="20"
                                           Foreground="{Binding StatusBrush, Mode=OneWay}"/>
                                <TextBlock Text="{Binding OccupancyDisplay, Mode=OneWay}" 
                                          HorizontalAlignment="Center"
                                          VerticalAlignment="Center"
                                          FontWeight="SemiBold"
                                          Foreground="White"/>
                            </Grid>
                        </DataTemplate>
                    </DataGridTemplateColumn.CellTemplate>
                </DataGridTemplateColumn>

                <!-- текстовый статус -->
                <DataGridTemplateColumn Header="Состояние" Width="150">
                    <DataGridTemplateColumn.CellTemplate>
                        <DataTemplate>
                            <TextBlock Text="{Binding StatusText, Mode=OneWay}" 
                                      HorizontalAlignment="Center"
                                      VerticalAlignment="Center"
                                      FontWeight="SemiBold"
                                      Foreground="{Binding StatusBrush, Mode=OneWay}"/>
                        </DataTemplate>
                    </DataGridTemplateColumn.CellTemplate>
                </DataGridTemplateColumn>
            </DataGrid.Columns>
        </DataGrid>

        <!-- панель с пациентами выбранной палаты -->
        <Border Grid.Row="3" Background="White" BorderBrush="#ddd" BorderThickness="0,1,0,0">
            <Grid>
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="*"/>
                </Grid.RowDefinitions>

                <!-- заголовок панели пациентов -->
                <Border Grid.Row="0" Background="#e3f2fd" Padding="10">
                    <Grid>
                        <TextBlock x:Name="lblSelectedWard" 
                                  Text="Выберите палату для просмотра пациентов"
                                  FontSize="14"
                                  FontWeight="SemiBold"
                                  HorizontalAlignment="Left"
                                  VerticalAlignment="Center"/>

                        <Button x:Name="btnTransferPatient" 
                               Content="↔️ Перевести пациента" 
                               Click="BtnTransferPatient_Click"
                               Background="#03A9F4"
                               Foreground="White"
                               HorizontalAlignment="Right"
                               IsEnabled="False"/>
                    </Grid>
                </Border>

                <!-- список пациентов -->
                <DataGrid x:Name="dgPatients" 
                         Grid.Row="1"
                         AutoGenerateColumns="False"
                         IsReadOnly="True"
                         SelectionMode="Single"
                         RowHeight="30"
                         AlternatingRowBackground="#fafafa"
                         GridLinesVisibility="Horizontal"
                         HeadersVisibility="Column"
                         CanUserResizeRows="False"
                         SelectionChanged="DgPatients_SelectionChanged">

                    <DataGrid.Columns>
                        <DataGridTextColumn Header="№ Карты" 
                                           Binding="{Binding CardNumber}" 
                                           Width="120"/>

                        <DataGridTextColumn Header="ФИО" 
                                           Binding="{Binding FullName}" 
                                           Width="*"
                                           MinWidth="200"/>

                        <DataGridTextColumn Header="Дата рождения" 
                                           Binding="{Binding BirthDate, StringFormat='dd.MM.yyyy'}" 
                                           Width="120"/>

                        <DataGridTextColumn Header="Диагноз" 
                                           Binding="{Binding Diagnosis}" 
                                           Width="*"
                                           MinWidth="150"/>

                        <DataGridTextColumn Header="Дата поступления" 
                                           Binding="{Binding AdmissionDate, StringFormat='dd.MM.yyyy'}" 
                                           Width="130"/>
                    </DataGrid.Columns>
                </DataGrid>
            </Grid>
        </Border>

        <!-- статусная строка -->
        <Border Grid.Row="4" Background="#f5f5f5" Padding="10" BorderBrush="#ddd" BorderThickness="0,1,0,0">
            <Grid>
                <!-- легенда цветов -->
                <StackPanel Orientation="Horizontal" HorizontalAlignment="Left">
                    <TextBlock Text="📊 Легенда заполненности палат:" 
                              FontWeight="SemiBold" 
                              Margin="0,0,10,0"
                              VerticalAlignment="Center"/>

                    <!-- зелёный: < 50% -->
                    <Ellipse Width="16" Height="16" Fill="#4CAF50" Margin="5,0"/>
                    <TextBlock Text="Есть места (&lt;50%)" Margin="0,0,15,0" VerticalAlignment="Center"/>

                    <!-- жёлтый: 50-79% -->
                    <Ellipse Width="16" Height="16" Fill="#FFC107" Margin="5,0"/>
                    <TextBlock Text="Заполнена наполовину (50-79%)" Margin="0,0,15,0" VerticalAlignment="Center"/>

                    <!-- оранжевый: 80-99% -->
                    <Ellipse Width="16" Height="16" Fill="#FF9800" Margin="5,0"/>
                    <TextBlock Text="Почти полная (≥80%)" Margin="0,0,15,0" VerticalAlignment="Center"/>

                    <!-- красный: 100% -->
                    <Ellipse Width="16" Height="16" Fill="#f44336" Margin="5,0"/>
                    <TextBlock Text="Полностью занята" Margin="0,0,0,0" VerticalAlignment="Center"/>
                </StackPanel>

                <TextBlock x:Name="lblSelectedInfo" 
                          Text=""
                          HorizontalAlignment="Right"
                          FontSize="12"
                          VerticalAlignment="Center"/>
            </Grid>
        </Border>
    </Grid>
</Window>
